<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Case of the Missing Heart</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f0f8;
      color: #333;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    .section { display: none; }
    .visible { display: block; }
    .btn { background: #d291bc; border: none; padding: 10px 20px; margin: 10px; cursor: pointer; border-radius: 5px; }
    .btn:hover { background: #b5838d; }
    .hint-btn { background: #a8dadc; }
    .hint-text { font-style: italic; color: #555; margin-top: 5px; }
    #memory-grid { display: grid; grid-template-columns: repeat(4, 60px); gap: 10px; justify-content: center; }
    .card { background: #fff; border: 1px solid #ccc; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
    .drag-container { display: flex; justify-content: space-around; flex-wrap: wrap; }
    .term, .def { border: 1px solid #ccc; padding: 8px; margin: 5px; background: #fff; width: 120px; }
    .def { background: #e8d2f7; }
  </style>
</head>
<body>
  <!-- Replace 'YOUR_DEEPSEEK_API_KEY' with your actual API key -->
  <script>
    const DEEPSEEK_API_KEY = 'sk-1bb02e160c734972bbb9514ede29a3f0';
    const DEEPSEEK_BASE_URL = 'https://api.deepseek.com';
    const fallbackHints = {
      scramble: `Try rearranging the letters to form common words‚Äîlook for prefixes or suffixes to help!`,
      memory: 'Hint: find two identical heart icons in succession.',
      statute: 'Hint: match each term logically: Objection = protest; Sustained = allowed; Overruled = disallowed.',
      cross: 'Hint: chocolate fingerprints point to the sweetest clue.'
    };

    async function getDeepSeekHint(puzzleType, data = {}) {
      try {
        const systemPrompt =
          `You are a playful, flirty hint assistant for the web game "Case of the Missing Heart"‚Äîa mystery-style puzzle celebrating National Girlfriend Day.`;
        const userPrompt =
          `Puzzle type: ${puzzleType}. Data: ${JSON.stringify(data)}. Provide a concise, cute hint.`;

        const res = await fetch(`${DEEPSEEK_BASE_URL}/chat/completions`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
          },
          body: JSON.stringify({
            model: 'deepseek-chat',
            messages: [
              { role: 'system', content: systemPrompt },
              { role: 'user', content: userPrompt }
            ],
            stream: false
          })
        });
        if (!res.ok) throw new Error('Network response not ok');
        const json = await res.json();
        const hint = json.choices?.[0]?.message?.content?.trim();
        return hint || fallbackHints[puzzleType];
      } catch (e) {
        console.warn('DeepSeek hint failed:', e);
        return fallbackHints[puzzleType];
      }
    }
  </script>

  <div id="opening" class="section visible">
    <h1>The Case of the Missing Heart</h1>
    <p>Someone's stolen your heart‚Äîlet‚Äôs reveal the culprit!</p>
    <button class="btn" onclick="nextSection('puzzle1')">Begin Your Defense</button>
  </div>

  <div id="puzzle1" class="section">
    <h2>Clue Scramble</h2>
    <p>Unscramble the note:</p>
    <p><em>"yuo ertocolle ievl &lt;3"</em></p>
    <input type="text" id="scramble-input" placeholder="Type here" />
    <button class="btn" onclick="checkScramble()">Check</button>
    <button class="btn hint-btn" onclick="showHint('scramble')">Hint</button>
    <p id="scramble-hint" class="hint-text"></p>
    <p id="scramble-msg"></p>
    <button class="btn" onclick="showObjection()">Objection!</button>
  </div>

  <div id="puzzle2" class="section">
    <h2>Fingerprint Match</h2>
    <p>Match twin hearts:</p>
    <div id="memory-grid"></div>
    <button class="btn hint-btn" onclick="showHint('memory')">Hint</button>
    <p id="memory-hint" class="hint-text"></p>
    <p id="memory-msg"></p>
    <button class="btn" onclick="showObjection()">Objection!</button>
  </div>

  <div id="puzzle3" class="section">
    <h2>Statute Match</h2>
    <p>Drag each definition onto the correct term:</p>
    <div class="drag-container">
      <div id="terms">
        <div class="term" data-term="Objection">Objection</div>
        <div class="term" data-term="Sustained">Sustained</div>
        <div class="term" data-term="Overruled">Overruled</div>
      </div>
      <div id="defs">
        <div class="def" draggable="true" id="def1">A lawyer protests a question‚Äôs validity</div>
        <div class="def" draggable="true" id="def2">A judge agrees the question is allowed</div>
        <div class="def" draggable="true" id="def3">A judge disallows a lawyer‚Äôs protest</div>
      </div>
    </div>
    <button class="btn" onclick="checkStatute()">Submit</button>
    <button class="btn hint-btn" onclick="showHint('statute')">Hint</button>
    <p id="statute-hint" class="hint-text"></p>
    <p id="statute-msg"></p>
    <button class="btn" onclick="showObjection()">Objection!</button>
  </div>

  <div id="crossExam" class="section">
    <h2>Cross-Examination</h2>
    <p>Select the statement that points to your Boyfriend:</p>
    <form id="cross-form">
      <label><input type="radio" name="q" value="0"> "I saw someone lingering by the cookie jar..."</label><br>
      <label><input type="radio" name="q" value="1"> "I noticed chocolate fingerprints all over..."</label><br>
      <label><input type="radio" name="q" value="2"> "Someone left rose petals in the hallway..."</label><br>
    </form>
    <button class="btn" onclick="checkCross()">Deliver Verdict</button>
    <button class="btn hint-btn" onclick="showHint('cross')">Hint</button>
    <p id="cross-hint" class="hint-text"></p>
    <p id="cross-msg"></p>
  </div>

  <div id="verdict" class="section">
    <h2>Verdict: <span style="color:#e63946">Guilty</span> (of Love!)</h2>
    <p>Objection overruled ‚Äì you stole my heart!</p>
    <button class="btn" onclick="downloadCert()">Download Your Certificate of Love</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    function nextSection(id) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('visible'));
      document.getElementById(id).classList.add('visible');
      if (id === 'puzzle2') initMemory();
    }
    async function showHint(type) {
      let data = {};
      if (type === 'scramble') {
        data.scrambled = 'yuo ertocolle ievl <3';
        data.guess = document.getElementById('scramble-input').value;
      }
      const hint = await getDeepSeekHint(type, data);
      document.getElementById(`${type}-hint`).textContent = hint;
    }
    function checkScramble() {
      const input = document.getElementById('scramble-input').value.trim().toLowerCase();
      const correct = 'you recollect evil <3';
      if (input === correct) { document.getElementById('scramble-msg').textContent = 'Correct!'; setTimeout(() => nextSection('puzzle2'), 1000); }
      else { document.getElementById('scramble-msg').textContent = 'Try again.'; }
    }
    let firstCard, secondCard, lock = false, matches = 0;
    function initMemory() {
      const grid = document.getElementById('memory-grid'); grid.innerHTML = '';
      ['üíñ','üíñ','üíï','üíï','‚ù§Ô∏è','‚ù§Ô∏è','üíó','üíó'].sort(() => 0.5 - Math.random()).forEach(icon => {
        const card = document.createElement('div'); card.className = 'card'; card.dataset.icon = icon;
        card.addEventListener('click', flipCard);
        grid.appendChild(card);
      }); matches = 0;
    }
    function flipCard() {
      if (lock || this === firstCard) return;
      this.textContent = this.dataset.icon;
      if (!firstCard) { firstCard = this; return; }
      secondCard = this; lock = true;
      if (firstCard.dataset.icon === secondCard.dataset.icon) { matches++; resetMatch(); }
      else { setTimeout(() => { firstCard.textContent = ''; secondCard.textContent = ''; resetMatch(); }, 800); }
      if (matches === 4) setTimeout(() => nextSection('puzzle3'), 500);
    }
    function resetMatch() { [firstCard, secondCard, lock] = [null, null, false]; }
    let dragged;
    document.querySelectorAll('.def').forEach(def => def.addEventListener('dragstart', e => dragged = e.target));
    document.querySelectorAll('.term').forEach(term => { term.addEventListener('dragover', e => e.preventDefault()); term.addEventListener('drop', e => { e.preventDefault(); term.appendChild(dragged); term.dataset.def = dragged.textContent; }); });
    function checkStatute() {
      const mapping = { 'Objection': 'A lawyer protests a question‚Äôs validity', 'Sustained': 'A judge agrees the question is allowed', 'Overruled': 'A judge disallows a lawyer‚Äôs protest' };
      const correctCount = Array.from(document.querySelectorAll('.term')).filter(t => t.dataset.def === mapping[t.dataset.term]).length;
      if (correctCount === 3) { document.getElementById('statute-msg').textContent = 'All set!'; setTimeout(() => nextSection('crossExam'), 1000); }
      else { document.getElementById('statute-msg').textContent = 'Check your matches.'; }
    }
    function checkCross() {
      const sel = document.querySelector('input[name="q"]:checked'); if (!sel) return alert('Please choose an option.');
      if (sel.value === '1') { document.getElementById('cross-msg').textContent = 'Correct!'; setTimeout(() => nextSection('verdict'), 1000); }
      else { document.getElementById('cross-msg').textContent = 'Not quite, try again.'; }
    }
    function showObjection() { alert('Objection sustained ‚Äì you‚Äôre too cute! ‚ù§Ô∏è'); }
    async function downloadCert() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF(); doc.setFontSize(22); doc.text('Certificate of Love', 20, 30);
      doc.setFontSize(16); doc.text('This certifies that you have successfully proven your love.', 20, 50);
      doc.text('Date: ' + new Date().toLocaleDateString(), 20, 70);
      doc.save('Certificate_of_Love.pdf');
    }
  </script>
</body>
</html>
